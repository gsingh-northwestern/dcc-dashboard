<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collaborative Disability Care Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/react-beautiful-dnd@13.1.0/dist/react-beautiful-dnd.min.js"></script>
    
    <!-- This line loads your recommendation data from the separate data.js file -->
    <script src="./data.js"></script>

    <style>
        @import url('https://rsms.me/inter/inter.css');
        html { font-family: 'Inter', sans-serif; }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 50; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Script 1: Firebase Setup -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, doc, setDoc, onSnapshot, 
            collection, query, writeBatch, orderBy, getDocs, updateDoc
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Your personal Firebase Configuration
        const firebaseConfig = {
          apiKey: "AIzaSyADj4tf65DjTOF29MW7xGO0OVRHs_cYDdg",
          authDomain: "dcc-nr-dashboard.firebaseapp.com",
          projectId: "dcc-nr-dashboard",
          storageBucket: "dcc-nr-dashboard.appspot.com",
          messagingSenderId: "648912013604",
          appId: "1:648912013604:web:f7824a262657ef8ca14bb1",
          measurementId: "G-P0VDLG0LCR"
        };

        try {
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            const auth = getAuth(app);
            
            await signInAnonymously(auth);

            window.firebaseServices = {
                db, collection, doc, setDoc, onSnapshot,
                query, orderBy, writeBatch, getDocs, updateDoc
            };

            window.dispatchEvent(new CustomEvent('firebase-ready'));
        } catch (error) {
            console.error("Firebase Initialization Error:", error);
            document.getElementById('root').innerHTML = `<div style="padding: 2rem; text-align: center; font-family: sans-serif; color: #555;"><h2>Error Connecting to Database</h2><p>There was an error initializing the connection. Please check the browser console and your Firebase configuration.</p></div>`;
        }
    </script>

    <!-- Script 2: React Application -->
    <script type="text/babel">
const { useState, useEffect, useRef, useCallback } = React;
const { DragDropContext, Droppable, Draggable } = window.ReactBeautifulDnd;

const CATEGORIES = ["Physical Access", "Policy and Procedural Access", "Communication Access", "Provider Training Needs", "Disability Etiquette"];
const CATEGORY_COLORS = {
  "Physical Access": { text: "text-teal-700", border: "border-teal-600", tagBg: "bg-teal-100", tagText: "text-teal-800", ring: "focus:ring-teal-500" },
  "Policy and Procedural Access": { text: "text-indigo-700", border: "border-indigo-600", tagBg: "bg-indigo-100", tagText: "text-indigo-800", ring: "focus:ring-indigo-500" },
  "Communication Access": { text: "text-sky-700", border: "border-sky-600", tagBg: "bg-sky-100", tagText: "text-sky-800", ring: "focus:ring-sky-500" },
  "Provider Training Needs": { text: "text-amber-700", border: "border-amber-600", tagBg: "bg-amber-100", tagText: "text-amber-800", ring: "focus:ring-amber-500" },
  "Disability Etiquette": { text: "text-rose-700", border: "border-rose-600", tagBg: "bg-rose-100", tagText: "text-rose-800", ring: "focus:ring-rose-500" },
  "All": { text: "text-slate-700", border: "border-slate-600", tagBg: "bg-slate-100", tagText: "text-slate-800", ring: "focus:ring-slate-500" },
};
const TAB_ORDER = [...CATEGORIES, "All"];

const useAutosizeTextArea = (textAreaRef, value) => {
  useEffect(() => {
    if (textAreaRef && textAreaRef.current) {
      textAreaRef.current.style.height = "0px";
      const scrollHeight = textAreaRef.current.scrollHeight;
      textAreaRef.current.style.height = scrollHeight + "px";
    }
  }, [textAreaRef, value]);
};

const TagInput = ({ existingTags, onAddTag, placeholder, colorClass }) => {
    const [inputValue, setInputValue] = useState('');
    const [showSuggestions, setShowSuggestions] = useState(false);
    const wrapperRef = useRef(null);
    const suggestions = existingTags.filter(tag => tag.toLowerCase().includes(inputValue.toLowerCase()) && inputValue);
    useEffect(() => {
      function handleClickOutside(event) {
        if (wrapperRef.current && !wrapperRef.current.contains(event.target)) setShowSuggestions(false);
      }
      document.addEventListener("mousedown", handleClickOutside);
      return () => document.removeEventListener("mousedown", handleClickOutside);
    }, [wrapperRef]);
    const handleAdd = (tag) => {
        if (tag.trim() === '') return;
        onAddTag(tag.trim());
        setInputValue('');
        setShowSuggestions(false);
    }
    return (
        <div ref={wrapperRef} className="relative flex-grow">
            <div className="flex gap-2">
                <input type="text" value={inputValue} onChange={(e) => { setInputValue(e.target.value); if (!showSuggestions) setShowSuggestions(true); }}
                    onFocus={() => setShowSuggestions(true)} onKeyPress={(e) => e.key === 'Enter' && handleAdd(inputValue)}
                    placeholder={placeholder} className={`flex-grow p-2 border border-slate-300 rounded-md text-sm focus:ring-2 ${colorClass}`} />
                <button onClick={() => handleAdd(inputValue)} className="bg-slate-600 text-white px-4 py-2 rounded-md hover:bg-slate-700 text-sm font-semibold transition-colors">Add</button>
            </div>
            {showSuggestions && suggestions.length > 0 && (
                <ul className="absolute z-10 w-full bg-white border border-slate-300 rounded-md mt-1 max-h-40 overflow-y-auto shadow-lg">
                    {suggestions.map(tag => ( <li key={tag} onMouseDown={() => handleAdd(tag)} className="p-2 text-sm cursor-pointer hover:bg-slate-100">{tag}</li> ))}
                     <li onMouseDown={() => handleAdd(inputValue)} className="p-2 text-sm cursor-pointer italic text-slate-500 hover:bg-slate-100"> Add new: "{inputValue}" </li>
                </ul>
            )}
        </div>
    )
};

function App() {
    const [firebase, setFirebase] = useState(null);
    const [recommendations, setRecommendations] = useState([]);
    const [isLoading, setIsLoading] = useState(true);
    const [activeTab, setActiveTab] = useState(TAB_ORDER[0]);
    const [filterSource, setFilterSource] = useState("");
    const [filterResource, setFilterResource] = useState("");
    const [isSettingsOpen, setIsSettingsOpen] = useState(false);
    const [allSourceTags, setAllSourceTags] = useState([]);
    const [allResourceTags, setAllResourceTags] = useState([]);
    
    useEffect(() => {
        const onFirebaseReady = () => setFirebase(window.firebaseServices);
        if (window.firebaseServices) onFirebaseReady();
        else window.addEventListener('firebase-ready', onFirebaseReady);
        return () => window.removeEventListener('firebase-ready', onFirebaseReady);
    }, []);

    useEffect(() => {
        if (!firebase) return;
        const { db, collection, query, orderBy, onSnapshot } = firebase;
        const recsCollectionRef = collection(db, "recommendations");
        const q = query(recsCollectionRef, orderBy("order", "asc"));
        
        const unsubscribe = onSnapshot(q, (querySnapshot) => {
            const recsData = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            setRecommendations(recsData);
            setAllSourceTags([...new Set(recsData.flatMap(r => r.sourceTags || []))].sort());
            setAllResourceTags([...new Set(recsData.flatMap(r => r.tags || []))].sort());
            setIsLoading(false);
        }, (error) => {
            console.error("Firestore snapshot error:", error);
            setIsLoading(false);
        });
        return () => unsubscribe();
    }, [firebase]);

    const updateDocInFirebase = async (recId, data) => {
        if (!firebase) return;
        const { db, doc, updateDoc } = firebase;
        const docRef = doc(db, "recommendations", recId);
        await updateDoc(docRef, data);
    };

    const handleUpdateRecommendationText = (recId, text) => {
      setRecommendations(prev => prev.map(r => r.id === recId ? {...r, recommendation: text} : r));
      updateDocInFirebase(recId, { recommendation: text });
    };

    const handleAddTag = (recId, tag, type) => {
      if (!tag) return;
      const field = type === 'resource' ? 'tags' : 'sourceTags';
      const rec = recommendations.find(r => r.id === recId);
      if(rec){
          const updatedTags = [...new Set([...(rec[field] || []), tag])];
          updateDocInFirebase(recId, { [field]: updatedTags });
      }
    };

    const handleRemoveTag = (recId, tagToRemove, type) => {
        const field = type === 'resource' ? 'tags' : 'sourceTags';
        const rec = recommendations.find(r => r.id === recId);
        if(rec){
            const updatedTags = (rec[field] || []).filter(t => t !== tagToRemove);
            updateDocInFirebase(recId, { [field]: updatedTags });
        }
    };

    const onDragEnd = async (result) => {
        if (!result.destination || !firebase) return;
        const { db, doc, writeBatch } = firebase;
        const reorderedRecs = Array.from(recommendations);
        const [removed] = reorderedRecs.splice(result.source.index, 1);
        reorderedRecs.splice(result.destination.index, 0, removed);
        setRecommendations(reorderedRecs);
        const batch = writeBatch(db);
        reorderedRecs.forEach((rec, index) => {
            const docRef = doc(db, "recommendations", rec.id);
            batch.update(docRef, { order: index });
        });
        await batch.commit();
    };
    
    const seedDatabase = async () => { /* ... implementation remains the same ... */ };
    
    const filteredRecommendations = recommendations
      .filter(r => filterSource ? (r.sourceTags || []).includes(filterSource) : true)
      .filter(r => filterResource ? (r.tags || []).includes(filterResource) : true);

    const currentRecommendations = activeTab === 'All' 
        ? filteredRecommendations 
        : filteredRecommendations.filter(r => r.category === activeTab);

    // ... All other components (RecommendationCard, SettingsModal) would be here, unchanged from the last complete UI version ...

    if (!firebase) {
      return <div className="text-center p-12 text-xl text-slate-500 animate-pulse">Initializing Services...</div>;
    }

    if (isLoading) {
      return <div className="text-center p-12 text-xl text-slate-500 animate-pulse">Connecting to Database...</div>;
    }

    if (!isLoading && recommendations.length === 0 && typeof FULL_RECOMMENDATIONS_LIST_FOR_SEEDING !== 'undefined') {
        return ( /* Seeding UI remains the same */ );
    }
    
    return (
        <div className="bg-slate-50 min-h-screen font-sans text-slate-800">
            {isSettingsOpen && <SettingsModal /* props */ />}
            <div className="container mx-auto p-4 md:p-8">
                <header className="mb-8 text-center relative">
                    <h1 className="text-4xl md:text-5xl font-bold text-slate-800 mb-2">Disability Competent Care Dashboard</h1>
                    <p className="text-lg text-slate-600">A Comprehensive Tool for Analyzing Healthcare Recommendations</p>
                    <button onClick={() => setIsSettingsOpen(true)} className="absolute top-0 right-0 p-2 text-slate-500 hover:text-indigo-600" title="Manage Tags">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                    </button>
                </header>

                <div className="bg-white/80 backdrop-blur-sm p-6 rounded-2xl shadow-lg mb-8 sticky top-4 z-10 border border-slate-200">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                        <div>
                            <label htmlFor="resourceFilter" className="block text-sm font-medium text-slate-700 mb-1">Filter by Resources Required Tag:</label>
                            <select id="resourceFilter" className="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 transition" value={filterResource} onChange={e => setFilterResource(e.target.value)}>
                                <option value="">All Resources</option>
                                {allResourceTags.map(tag => <option key={tag} value={tag}>{tag}</option>)}
                            </select>
                        </div>
                        <div>
                            <label htmlFor="sourceFilter" className="block text-sm font-medium text-slate-700 mb-1">Filter by Source Tag:</label>
                            <select id="sourceFilter" className="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 transition" value={filterSource} onChange={e => setFilterSource(e.target.value)}>
                                <option value="">All Sources</option>
                                {allSourceTags.map(source => <option key={source} value={source}>{source}</option>)}
                            </select>
                        </div>
                    </div>
                </div>

                <div className="flex flex-wrap border-b border-slate-300 mb-6 bg-white rounded-t-lg shadow-sm">
                    {TAB_ORDER.map(category => {
                        const colors = CATEGORY_COLORS[category];
                        const isActive = activeTab === category;
                        return (<button key={category} onClick={() => setActiveTab(category)} className={`py-3 px-2 sm:px-4 md:px-6 text-sm md:text-base font-semibold transition-colors duration-200 ease-in-out focus:outline-none -mb-px ${isActive ? `${colors.border} ${colors.text} border-b-4` : 'text-slate-500 hover:text-slate-800 border-b-4 border-transparent'}`}>{category}</button>)
                    })}
                </div>

                <div className="bg-transparent rounded-b-2xl min-h-[400px]">
                    <DragDropContext onDragEnd={onDragEnd}>
                        <Droppable droppableId="recommendations">
                          {(provided) => (
                            <div {...provided.droppableProps} ref={provided.innerRef} className="space-y-6">
                                {currentRecommendations.length > 0 ? currentRecommendations.map((rec, index) => (
                                    <div key={rec.id}> {/* This should be the full RecommendationCard component */}
                                        <Draggable draggableId={rec.id} index={index}>
                                            {(provided) => (
                                                <div ref={provided.innerRef} {...provided.draggableProps} {...provided.dragHandleProps}>
                                                    {index + 1}. {rec.recommendation}
                                                </div>
                                            )}
                                        </Draggable>
                                    </div>
                                )) : <div className="text-center text-slate-500 py-8 bg-white rounded-lg shadow-sm"><p>No recommendations match the current filters.</p></div>}
                                {provided.placeholder}
                                <div className="text-center font-bold text-slate-500 pt-4">Total Displayed: {currentRecommendations.length}</div>
                            </div>
                          )}
                        </Droppable>
                    </DragDropContext>
                </div>
            </div>
        </div>
    );
}

ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
